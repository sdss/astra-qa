---
title: "Reddening"
---


```{python}
import numpy as np
import matplotlib.pyplot as plt
import astropy.units as u
from astropy.coordinates import SkyCoord
from astra.models import Source
import healpy as hp

q = (
    Source
    .select(
        Source.ra,
        Source.dec,
        Source.ebv
    )
    .tuples()
)
data = np.array(list(q)).astype(float)
finite = np.all(np.isfinite(data), axis=1)
ra, dec, ebv = data[finite].T


n_side = 128
n_pix = hp.nside2npix(n_side)

coord = SkyCoord(ra=ra * u.deg, dec=dec * u.deg)
theta = np.pi/2 - coord.galactic.b.rad
phi = coord.galactic.l.rad

indices = hp.ang2pix(n_side, theta, phi)
hpx_map = np.nan * np.ones(n_pix)
hpx_map[indices] = ebv

fig = plt.figure(figsize=(10, 10), dpi=300)
hp.mollview(hpx_map, min=0, max=5, cmap="inferno", fig=fig, title=None)
ax, cbar = fig.axes
cbar.set_xlabel(r"E(B-V) [mag]")
None
```
